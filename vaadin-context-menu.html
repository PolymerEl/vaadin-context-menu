<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="vaadin-context-menu-overlay.html">

<dom-module id="vaadin-context-menu">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <vaadin-context-menu-overlay id="overlay" opened="{{opened}}">
      <div class="dropdown-content" style="background: red; width: 200px; height: 200px">Hello!</div>
    </vaadin-context-menu-overlay>

  </template>
  <script>
    Polymer({
      is: 'vaadin-context-menu',

      properties: {
        target: {
          type: Object,
          observer: '_targetChanged'
        },
        targetSelector: {
          type: String,
          observer: '_targetSelectorChanged'
        },
        opened: {
          value: false,
          notify: true
        }
      },

      observers: ['_targetSelectorChanged(isAttached, targetSelector)'],

      attached: function() {
        if (!this.target) {
          this.target = this.parentElement;
        }
      },

      _targetChanged: function(target, oldTarget) {
        if (oldTarget) {
          this.unlisten(oldTarget, 'contextmenu', '_onContextMenu');
        }
        if (target) {
          this.listen(target, 'contextmenu', '_onContextMenu');
        }
      },

      _onContextMenu: function(e) {
        e.preventDefault();

        this.$.overlay.x = e.clientX;
        this.$.overlay.y = e.clientY;
        this.opened = true;
      },

      _targetSelectorChanged: function(isAttached, targetSelector) {
        if (isAttached) {
          var host = Polymer.dom(this).parentNode;
          // TODO: use querySelectorAll and use target as array for multi-targeting?
          this.target = Polymer.dom(host).querySelector(targetSelector);
        }
      }
    });
  </script>
</dom-module>
